<?xml version="1.0" encoding="utf-8"?>
<modification>
	<code>oct_deals_theme</code>
	<name>Octemplates - deals Theme</name>
	<version>1.1.0</version>
	<author>Octemplates</author>
	<link>https://octemplates.net/</link>
	<file path="admin/controller/common/filemanager.php">
		<operation>
			<search trim="true"><![CDATA[gif,]]></search>
			<add trim="true" position="replace"><![CDATA[gif,svg,SVG,]]></add>
		</operation>
		<operation>
			<search trim="true"><![CDATA['png']]></search>
			<add trim="true" position="before"><![CDATA[
			'svg',
			]]></add>
		</operation>
		<operation>
			<search trim="true"><![CDATA['image/gif']]></search>
			<add trim="true" position="before"><![CDATA[
			'image/svg+xml',
			]]></add>
		</operation>
	</file>
	<file path="admin/controller/startup/permission.php">
    	<operation error="skip">
			<search><![CDATA['extension/module',]]></search>
			<add position="before"><![CDATA[
			'octemplates/stickers',
			'octemplates/blog',
			'octemplates/design',
			'octemplates/faq',
			'octemplates/module',
			'octemplates/menu',
			]]></add>
    	</operation>
	</file>
	<file path="admin/model/extension/dashboard/map.php">
        <operation error="skip">
            <search><![CDATA[$query = $this->db->query("SELECT COUNT(*) AS total, SUM(o.total) AS amount, c.iso_code_2 FROM `" . DB_PREFIX . "order` o LEFT JOIN `" . DB_PREFIX . "country` c ON (o.payment_country_id = c.country_id) WHERE o.order_status_id IN(" . implode(',', $implode) . ") GROUP BY o.payment_country_id");]]></search>
            <add position="replace">
                <![CDATA[
                $query = $this->db->query("SELECT COUNT(*) AS total, SUM(o.total) AS amount, c.iso_code_2 FROM `" . DB_PREFIX . "order` o LEFT JOIN `" . DB_PREFIX . "country` c ON (o.payment_country_id = c.country_id) WHERE o.order_status_id IN(" . implode(',', $implode) . ") AND c.iso_code_2 IS NOT NULL AND c.iso_code_2 != '' GROUP BY o.payment_country_id");
                ]]>
            </add>
        </operation>
    </file>
	<file path="catalog/language/*/*.php">
    	<operation error="skip">
			<search><![CDATA[$_['thousand_point']]]></search>
			<add position="after"><![CDATA[$_['thousand_point'] = ' ';]]></add>
    	</operation>
	</file>
	<file path="admin/controller/extension/extension/promotion.php">
		<operation error="skip">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[return '';]]></add>
		</operation>
	</file>
	<file path="admin/controller/catalog/category.php">
    	<operation error="skip">
			<search><![CDATA[$data['placeholder'] = $this->model_tool_image->resize('no_image.png', 100, 100);]]></search>
			<add position="after"><![CDATA[
			if (isset($this->request->post['oct_image'])) {
				$data['oct_image'] = $this->request->post['oct_image'];
			} elseif (!empty($category_info)) {
				$data['oct_image'] = $category_info['oct_image'];
			} else {
				$data['oct_image'] = '';
			}

			if (isset($this->request->post['oct_image']) && is_file(DIR_IMAGE . $this->request->post['oct_image'])) {
				$data['oct_thumb_icon'] = $this->model_tool_image->resize($this->request->post['oct_image'], 100, 100);
			} elseif (!empty($category_info) && is_file(DIR_IMAGE . $category_info['oct_image'])) {
				$data['oct_thumb_icon'] = $this->model_tool_image->resize($category_info['oct_image'], 100, 100);
			} else {
				$data['oct_thumb_icon'] = $this->model_tool_image->resize('no_image.png', 100, 100);
			}
			]]></add>
    	</operation>
	</file>
	<file path="admin/model/catalog/category.php">
    	<operation error="skip">
			<search><![CDATA[if (isset($data['image'])) {]]></search>
			<add position="before"><![CDATA[
			if (isset($data['oct_image'])) {
				$this->db->query("UPDATE " . DB_PREFIX . "category SET oct_image = '" . $this->db->escape($data['oct_image']) . "' WHERE category_id = '" . (int)$category_id . "'");
			}
			]]></add>
    	</operation>
	</file>
	<file path="admin/view/template/catalog/category_form.twig">
    	<operation error="skip">
			<search><![CDATA[<label class="col-sm-2 control-label" for="input-top"><span data-toggle="tooltip" title="{{ help_top }}">{{ entry_top }}</span></label>]]></search>
			<add position="before" offset="1"><![CDATA[
			<div class="form-group">
                <label class="col-sm-2 control-label">{{ entry_oct_image }}</label>
                <div class="col-sm-10"><a href="" id="thumb-oct_image" data-toggle="image" class="img-oct_thumbnail"><img style="width:100px;" src="{{ oct_thumb_icon }}" alt="" title="" data-placeholder="{{ placeholder }}" /></a>
                  <input type="hidden" name="oct_image" value="{{ oct_image }}" id="input-oct_image" />
                </div>
            </div>
			]]></add>
    	</operation>
	</file>
	<file path="admin/controller/catalog/category.php">
		<operation error="skip">
			<search><![CDATA[$data['languages'] = $this->model_localisation_language->getLanguages();]]></search>
			<add position="after"><![CDATA[
			$oct_deals_data = $this->config->get('theme_oct_deals_data');

			if (isset($oct_deals_data['category_page']) && $oct_deals_data['category_page']) {
				$data['oct_cat_page'] = $oct_deals_data['category_page'];

				if (isset($this->request->post['oct_cat_pages'])) {
					$data['oct_cat_pages'] = $this->request->post['oct_cat_pages'];
				} elseif (isset($this->request->get['category_id'])) {
					$data['oct_cat_pages'] = $this->model_catalog_category->getOCTCatPages($this->request->get['category_id']);
				} else {
					$data['oct_cat_pages'] = [];
				}
			}
			]]></add>
    	</operation>
	</file>
	<file path="admin/model/catalog/category.php">
		<operation error="skip">
			<search><![CDATA[if (isset($data['image'])) {]]></search>
			<add position="before"><![CDATA[
			$oct_deals_data = $this->config->get('theme_oct_deals_data');

			if (isset($oct_deals_data['category_page']) && $oct_deals_data['category_page']) {
				$this->db->query("UPDATE " . DB_PREFIX . "category SET page_group_links = '' WHERE category_id = '" . (int)$category_id . "'");

				if (isset($data['oct_cat_pages'])) {
					$this->db->query("UPDATE " . DB_PREFIX . "category SET page_group_links = '" . $this->db->escape(serialize($data['oct_cat_pages'])) . "' WHERE category_id = '" . (int)$category_id . "'");
				}

				$this->cache->delete('octemplates');
			}
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[public function getTotalCategories() {]]></search>
			<add position="before"><![CDATA[
			public function getOCTCatPages($category_id) {
				$query = $this->db->query("SELECT page_group_links FROM " . DB_PREFIX . "category WHERE category_id = '". (int) $category_id ."'");

				return unserialize($query->row['page_group_links']);
			}
			]]></add>
    	</operation>
	</file>
	<file path="admin/view/template/catalog/category_form.twig">
    	<operation error="skip">
			<search><![CDATA[<li><a href="#tab-design" data-toggle="tab">{{ tab_design }}</a></li>]]></search>
			<add position="after"><![CDATA[
			{% if oct_cat_page is defined and oct_cat_page %}
			<li><a href="#tab-pages" data-toggle="tab">{{ tab_oct_category_pages }}</a></li>
			{% endif %}
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[<div class="tab-pane" id="tab-seo">]]></search>
			<add position="before"><![CDATA[
			{% if oct_cat_page is defined and oct_cat_page %}
			<div class="tab-pane" id="tab-pages">
            		<table class="table table-bordered table-hover" id="oct_cat_pages_table">
					<tbody class="group_in">
						{% set advantages_row = 0 %}
						{% set advantages_row_page = 0 %}
						{% for oct_cat_page in oct_cat_pages %}
						<tr id="advantage-row{{ advantages_row }}">
							<td>
								<table class="table table-bordered table-hover">
									<thead>
										<tr>
											<th>{{ text_oct_group_links }}</th>
											<th></th>
										</tr>
									</thead>
									<tr>
										<td class="text-right">
											{% for language in languages %}
											<div class="input-group">
						                        <span class="input-group-addon">
						                        	<img src="language/{{ language.code }}/{{ language.code }}.png" title="{{ language.name }}" />
						                        </span>
												<input type="text" name="oct_cat_pages[{{ advantages_row }}][page_group][{{ language.language_id }}]" value="{{ oct_cat_page.page_group[language.language_id] }}" id="advantage-title-{{ advantages_row }}{{ language.language_id }}" class="form-control" />
											</div>
											{% endfor %}
											<br />
											<table class="table table-bordered table-hover">
												<thead>
													<tr>
														<th>{{ text_oct_group_links_title }}</th>
														<th>{{ text_oct_group_links_link }}</th>
														<th></th>
													</tr>
												</thead>
												<tbody class="links_in{{ advantages_row }}">
													{% for oct_cat_page_link in oct_cat_page.page_links %}
													<tr id="advantage-page-row{{ advantages_row }}-{{ advantages_row_page }}">
														<td>
															{% for language in languages %}
															<div class="input-group">
										                        <span class="input-group-addon">
										                        	<img src="language/{{ language.code }}/{{ language.code }}.png" title="{{ language.name }}" />
										                        </span>
																<input type="text" name="oct_cat_pages[{{ advantages_row }}][page_links][{{ advantages_row_page }}][{{ language.language_id }}][title]" value="{{ oct_cat_page_link[language.language_id].title }}" id="advantage-linktitle-{{ advantages_row }}{{ advantages_row_page }}{{ language.language_id }}" class="form-control" />
															</div>
															{% endfor %}
														</td>
														<td>
															{% for language in languages %}
															<div class="input-group">
										                        <span class="input-group-addon">
										                        	<img src="language/{{ language.code }}/{{ language.code }}.png" title="{{ language.name }}" />
										                        </span>
																<input type="text" name="oct_cat_pages[{{ advantages_row }}][page_links][{{ advantages_row_page }}][{{ language.language_id }}][link]" value="{{ oct_cat_page_link[language.language_id].link }}" id="advantage-link-{{ advantages_row }}{{ advantages_row_page }}{{ language.language_id }}" class="form-control" />
															</div>
															{% endfor %}
														</td>
														<td class="text-left" style="width:5%;">
															<button type="button" onclick="$('#advantage-page-row{{ advantages_row }}-{{ advantages_row_page }}').remove()" data-toggle="tooltip" title="{{ button_remove }}" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button>
														</td>
													</tr>
													{% set advantages_row_page = advantages_row_page + 1 %}
													{% endfor %}
												</tbody>
												<tfoot>
													<tr>
														<td colspan="2"></td>
														<td class="text-left" style="width:5%;">
															<button type="button" onclick="addOCTCatLink({{ advantages_row }});" data-toggle="tooltip" title="" class="btn btn-primary" data-original-title="add group"><i class="fa fa-plus-circle"></i></button>
														</td>
													</tr>
												</tfoot>
											</table>
										</td>
										<td class="text-right" style="width:5%;">
											<button type="button" onclick="$('#advantage-row{{ advantages_row }}').remove()" data-toggle="tooltip" title="{{ button_remove }}" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button>
										</td>
									</tr>
								</table>
							</td>
						</tr>
						{% set advantages_row = advantages_row + 1 %}
						{% endfor %}
					</tbody>
					<tfoot>
						<tr>
							<td class="text-right">
								<button type="button" onclick="addOCTCatGroup();" data-toggle="tooltip" title="" class="btn btn-primary" data-original-title="add group"><i class="fa fa-plus-circle"></i></button>
							</td>
						</tr>
					</tfoot>
				</table>
				<script>
				let advantages_row = {{ advantages_row }};

				function addOCTCatGroup() {
					const html = `
					<tr id="advantage-row${ advantages_row }">
						<td>
							<table class="table table-bordered table-hover">
								<thead>
									<tr>
										<th>{{ text_oct_group_links }}</th>
										<th></th>
									</tr>
								</thead>
								<tr>
									<td class="text-right">
										{% for language in languages %}
										<div class="input-group">
					                        <span class="input-group-addon">
					                        	<img src="language/{{ language.code }}/{{ language.code }}.png" title="{{ language.name }}" />
					                        </span>
											<input type="text" name="oct_cat_pages[${ advantages_row }][page_group][{{ language.language_id }}]" value="" id="advantage-title-${ advantages_row }{{ language.language_id }}" class="form-control" />
										</div>
										{% endfor %}
										<br />
										<table class="table table-bordered table-hover">
											<thead>
												<tr>
													<th>{{ text_oct_group_links_title }}</th>
													<th>{{ text_oct_group_links_link }}</th>
													<th></th>
												</tr>
											</thead>
											<tbody class="links_in${ advantages_row }"></tbody>
											<tfoot>
												<tr>
													<td colspan="2"></td>
													<td class="text-left" style="width:5%;">
														<button type="button" onclick="addOCTCatLink(${ advantages_row });" data-toggle="tooltip" title="" class="btn btn-primary" data-original-title="add group"><i class="fa fa-plus-circle"></i></button>
													</td>
												</tr>
											</tfoot>
										</table>
									</td>
									<td class="text-right" style="width:5%;">
										<button type="button" onclick="$('#advantage-row${ advantages_row }').remove()" data-toggle="tooltip" title="{{ button_remove }}" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button>
									</td>
								</tr>
							</table>
						</td>
					</tr>
					`;

					$('#oct_cat_pages_table tbody.group_in').append(html);

					advantages_row++;
				}

				let advantages_row_page = {{ advantages_row_page }};

				function addOCTCatLink(row) {
					const html = `
					<tr id="advantage-page-row${ row }-${ advantages_row_page }">
						<td>
							{% for language in languages %}
							<div class="input-group">
		                        <span class="input-group-addon">
		                        	<img src="language/{{ language.code }}/{{ language.code }}.png" title="{{ language.name }}" />
		                        </span>
								<input type="text" name="oct_cat_pages[${ row }][page_links][${ advantages_row_page }][{{ language.language_id }}][title]" value="" id="advantage-linktitle-${ row }${ advantages_row_page }{{ language.language_id }}" class="form-control" />
							</div>
							{% endfor %}
						</td>
						<td>
							{% for language in languages %}
							<div class="input-group">
		                        <span class="input-group-addon">
		                        	<img src="language/{{ language.code }}/{{ language.code }}.png" title="{{ language.name }}" />
		                        </span>
								<input type="text" name="oct_cat_pages[${ row }][page_links][${ advantages_row_page }][{{ language.language_id }}][link]" value="" id="advantage-link-${ row }${ advantages_row_page }{{ language.language_id }}" class="form-control" />
							</div>
							{% endfor %}
						</td>
						<td class="text-left" style="width:5%;">
							<button type="button" onclick="$('#advantage-page-row${ row }-${ advantages_row_page }').remove()" data-toggle="tooltip" title="{{ button_remove }}" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button>
						</td>
					</tr>
					`;

					$('#oct_cat_pages_table tbody.links_in'+row).append(html);

					advantages_row_page++;
				}
				</script>
            </div>
            {% endif %}
			]]></add>
    	</operation>
	</file>
	<file path="catalog/model/tool/image.php">
		<operation error="skip">
			<search trim="true"><![CDATA[$extension = pathinfo($filename, PATHINFO_EXTENSION);]]></search>
			<add trim="true" position="after"><![CDATA[
			if (strtolower($extension) == 'svg') {
				$oct_webp_image = $octWebpIs = false;

				$image_new = $filename;
			} else {
			]]></add>
		</operation>
		<operation error="skip">
			<search trim="true"><![CDATA[return $this->config->get('config_ssl') . 'image/' . $image_new;]]></search>
			<add trim="true" position="before" offset="1"> <![CDATA[
			}
			]]></add>
		</operation>
	</file>
	<file path="admin/model/tool/image.php">
		<operation error="skip">
			<search trim="true"><![CDATA[$extension = pathinfo($filename, PATHINFO_EXTENSION);]]></search>
			<add trim="true" position="after"><![CDATA[
			if (strtolower($extension) == 'svg') {
				$image_new = $filename;
			} else {
			]]></add>
		</operation>
		<operation error="skip">
			<search trim="true"><![CDATA[return HTTPS_CATALOG . 'image/' . $image_new;]]></search>
			<add trim="true" position="before" offset="1"> <![CDATA[
			}
			]]></add>
		</operation>
	</file>
	<file path="admin/controller/catalog/information.php">
		<operation error="skip">
			<search><![CDATA[protected function validateDelete() {]]></search>
			<add position="before"><![CDATA[
			public function octAutocomplete() {
				$json = array();

				if (isset($this->request->get['filter_name'])) {
					$this->load->model('catalog/information');

					$filter_data = array(
						'filter_name' => $this->request->get['filter_name'],
						'sort'        => 'id.title',
						'order'       => 'ASC',
						'start'       => 0,
						'limit'       => 5
					);

					$results = $this->model_catalog_information->getInformations($filter_data);

					foreach ($results as $result) {
						$json[] = array(
							'information_id' => $result['information_id'],
							'name'       	 => strip_tags(html_entity_decode($result['title'], ENT_QUOTES, 'UTF-8')),
							'href'		  	 => $this->model_catalog_information->getInformationSeoUrls((int)$result['information_id']),
							'description' 	 => $this->model_catalog_information->getInformationDescriptions((int)$result['information_id']),
						);
					}
				}

				$sort_order = array();

				foreach ($json as $key => $value) {
					$sort_order[$key] = $value['name'];
				}

				array_multisort($sort_order, SORT_ASC, $json);

				$this->response->addHeader('Content-Type: application/json');
				$this->response->setOutput(json_encode($json));
			}
			]]></add>
    	</operation>
	</file>
	<file path="admin/controller/setting/setting.php">
		<operation error="skip">
			<search><![CDATA[if (isset($this->request->post['config_logo'])) {]]></search>
			<add position="before"><![CDATA[
			$this->load->language('octemplates/theme/oct_deals');

			$data['captcha_pages'][] = array(
				'text'  => $this->language->get('entry_captcha_popup_purchase'),
				'value' => 'oct_popup_purchase'
			);

			$data['captcha_pages'][] = array(
				'text'  => $this->language->get('entry_captcha_sreview_reviews'),
				'value' => 'oct_sreview_reviews'
			);
			]]></add>
    	</operation>
	</file>
	<file path="admin/controller/extension/module/carousel.php">
		<operation error="skip">
			<search><![CDATA[if (isset($this->request->post['banner_id'])) {]]></search>
			<add position="before"><![CDATA[
			$this->load->language('octemplates/oct_deals');

			$this->load->model('localisation/language');
			$data['languages'] = $this->model_localisation_language->getLanguages();

			if (isset($this->request->post['title'])) {
				$data['title'] = $this->request->post['title'];
			} elseif (!empty($module_info)) {
				$data['title'] = isset($module_info['title']) ? $module_info['title'] : [];
			} else {
				$data['title'] = [];
			}
			]]></add>
    	</operation>
	</file>
	<file path="admin/model/catalog/product.php">
		<operation error="skip">
			<search><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "product_image]]></search>
			<add position="before"><![CDATA[
			if (!empty($product_image['image']) && file_exists(DIR_IMAGE . $product_image['image'])) {
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "product_image]]></search>
			<add position="after"><![CDATA[
			}
			]]></add>
    	</operation>
	</file>
	<file path="admin/view/template/extension/module/carousel.twig">
		<operation error="skip">
			<search><![CDATA[<div class="text-danger">{{ error_name }}</div>]]></search>
			<add position="after" offset="3"><![CDATA[
			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-title">{{ entry_title }}</label>
				<div class="col-sm-10">
					<ul class="nav nav-tabs" id="title">
						{% for language in languages %}
						<li><a href="#tab-title-language{{ language.language_id }}" data-toggle="tab"><img src="language/{{ language.code }}/{{ language.code }}.png" title="{{ language.name }}" /> {{ language.name }}</a></li>
						{% endfor %}
					</ul>
					<div class="tab-content">
						{% for language in languages %}
						<div class="tab-pane" id="tab-title-language{{ language.language_id }}">
							<input type="text" name="title[{{ language.language_id }}]" value="{{ title[language.language_id] }}" placeholder="{{ entry_title }}" id="input-title" class="form-control" />
						</div>
						{% endfor %}
					</div>
				</div>
			</div>
			<script>
			$('#title a:first').tab('show');
			</script>
			]]></add>
    	</operation>
	</file>
	<file path="admin/model/localisation/language.php">
		<operation error="skip">
			<search><![CDATA[$language_data = $this->cache->get('language');]]></search>
			<add position="replace"><![CDATA[
			$language_data = $this->cache->get('admin.language');
			]]></add>
    	</operation>
	</file>
	<file path="admin/controller/catalog/review.php">
        <operation error="skip">
            <search><![CDATA[if (isset($this->request->post['rating'])) {]]></search>
            <add position="before"><![CDATA[
			if (isset($this->request->post['reply'])) {
				$data['reply'] = $this->request->post['reply'];
			} elseif (!empty($review_info)) {
				$data['reply'] = isset($review_info['reply']) ? $review_info['reply'] : '';
			} else {
				$data['reply'] = '';
			}
			]]></add>
        </operation>
	</file>
	<file path="admin/view/template/catalog/review_form.twig">
        <operation error="skip">
            <search><![CDATA[<label class="col-sm-2 control-label" for="input-name">{{ entry_rating }}</label>]]></search>
            <add position="before" offset="1"><![CDATA[
			<div class="form-group">
	            <label class="col-sm-2 control-label" for="input-admin-answer">{{ entry_reply }}</label>
	            <div class="col-sm-10">
	              <textarea name="admin_answer" cols="60" rows="8" placeholder="{{ entry_reply }}" id="input-admin-answer" class="form-control">{{ admin_answer }}</textarea>
	            </div>
	          </div>
			  <div class="form-group">
	            <label class="col-sm-2 control-label" for="input-positive-text">{{ entry_positive }}</label>
	            <div class="col-sm-10">
	              <textarea name="positive_text" cols="60" rows="8" placeholder="{{ entry_positive }}" id="input-positive-text" class="form-control">{{ positive_text }}</textarea>
	            </div>
	          </div>
			  <div class="form-group">
	            <label class="col-sm-2 control-label" for="input-negative-text">{{ entry_negative }}</label>
	            <div class="col-sm-10">
	              <textarea name="negative_text" cols="60" rows="8" placeholder="{{ negative_text }}" id="input-negative-text" class="form-control">{{ negative_text }}</textarea>
	            </div>
	          </div>
			]]></add>
        </operation>
	</file>
	<file path="catalog/controller/startup/startup.php">
		<operation error="skip">
			<search><![CDATA[Cart($this->registry));]]></search>
			<add position="after"><![CDATA[
			require_once DIR_SYSTEM. 'library/octemplates/Mobile_Detect.php';

			$this->registry->set('oct_mobiledetect', new OCTMobile_Detect());
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/extension/module/carousel.php">
		<operation error="skip">
			<search><![CDATA[$data['banners'] = array();]]></search>
			<add position="before"><![CDATA[
			$data['heading_title'] = (isset($setting['title'][(int)$this->config->get('config_language_id')]) && !empty($setting['title'][(int)$this->config->get('config_language_id')])) ? $setting['title'][(int)$this->config->get('config_language_id')] : '';
			]]></add>
    	</operation>
	</file>
	<file path="system/library/document.php">
	    <operation>
			<search><![CDATA[private $scripts = array();]]></search>
			<add position="after"><![CDATA[
			private $oct_files = [];
			private $octOpenGraph = [];
			private $octStyles = [];
			private $octScripts = [];

			public function setOCTPreload($oct_file) {
				$this->oct_files[$oct_file] = $oct_file;
			}

			public function getOCTPreload() {
				return $this->oct_files;
			}

            public function setOCTOpenGraph($property, $content) {
        		$this->octOpenGraph[$property] = [
                    'property' => $property,
                    'content' => $content
                ];
        	}

            public function getOCTOpenGraph() {
                return $this->octOpenGraph;
            }

			public function addOctStyle($href, $rel = 'stylesheet', $media = 'screen', $position = 'header') {
				$href = $this->removeVersion($href);

				$this->octStyles[$position][$href] = [
					'href'  => $href,
					'rel'   => $rel,
					'media' => $media
				];
			}

			public function getOctStyles($position = 'header') {
				if (isset($this->octStyles[$position])) {
					$styles = isset($this->styles) ? isset($this->styles[$position]) ? $this->styles[$position] : $this->styles : [];
					$this->styles = [];
					$this->styles[$position] = [];

					foreach ($styles as $style) {
						$href = $this->removeVersion($style['href']);

						$this->styles[$position][$href] = [
							'href'  => $href,
							'rel'   => $style['rel'],
							'media' => $style['media']
						];
					}

					return array_merge($this->octStyles[$position], $this->styles[$position]);
				} else {
					return [];
				}
			}

			public function addOctScript($href, $position = 'header') {
				$href = $this->removeVersion($href);

				$this->octScripts[$position][$href] = $href;
			}

			public function getOctScripts($position = 'header') {
				if (isset($this->octScripts[$position])) {
					$scripts = isset($this->scripts[$position]) ? $this->scripts[$position] : [];
					$this->scripts[$position] = [];

					foreach ($scripts as $script) {
						$href = $this->removeVersion($script);

						$this->scripts[$position][$href] = $href;
					}

					return array_merge($this->octScripts[$position], $this->scripts[$position]);
				} else {
					return array();
				}
			}

			private function removeVersion($link) {
				$href = explode('?', $link);

				if (file_exists($_SERVER['DOCUMENT_ROOT'] . '/' . ltrim($href[0]))) {
			       $link = $href[0];
		        }

		        return $link;
		    }
			]]></add>
    	</operation>
    </file>
	<file path="system/library/response.php">
		<operation error="skip">
			<search><![CDATA[public function output() {]]></search>
			<add position="after"><![CDATA[
			if (!defined('HTTP_CATALOG') && $this->output) $this->output = str_replace('index.php?route=common/home', '', $this->output);

			$oct_output = $this->output;

			if ($oct_output) {

				preg_match_all("/<style>(.*?)<\/style>/is", $oct_output, $oct_css_code);

				if (isset($oct_css_code[1]) && !empty($oct_css_code[1]) && !defined('HTTP_CATALOG')) {
					$oct_output = preg_replace("/<style>.*?<\/style>/is", '', $oct_output);

					$styles = "<style>";

					foreach ($oct_css_code[1] as $code) {
						$styles .= $code;
					}

					$styles .= "</style></head>";

					$oct_output = str_replace("</head>", $styles, $oct_output);
				}

				if (preg_match("/<script id=\"dataFonts\">/is", $oct_output, $oct_js) && !defined('HTTP_CATALOG')) { 

					preg_match_all("/<script(?![^>]*\s(id|src))[^>]*>(.*?)<\/script>/is", $oct_output, $oct_inline_scripts);

					if (!empty($oct_inline_scripts[0])) {

						$js_code = "";
						foreach ($oct_inline_scripts[0] as $code) {
							$js_code .= $code . "\r\n";
						}

						$oct_output = preg_replace("/<script(?![^>]*\s(id|src))[^>]*>(.*?)<\/script>/is", '', $oct_output);

						preg_match("/<script src=\"https?:\/\/[^\/]+\/min(.*?)<\/script>/", $oct_output, $oct_min_script);
						$oct_output = preg_replace("/<script src=\"https?:\/\/[^\/]+\/min(.*?)<\/script>/i", '', $oct_output);

						preg_match_all("/<script src=\"(.*?)<\/script>/", $oct_output, $oct_js_code_lines);
						$oct_output = preg_replace("/<script src=\"(.*?)<\/script>/i", '', $oct_output);

						$js_src = "";
						if (!empty($oct_js_code_lines[0])) {
							foreach ($oct_js_code_lines[0] as $code) {
								$js_src .= $code . "\r\n";
							}
						}

						$oct_output = str_replace(
							"</footer>",
							"</footer>" . $js_src . "\r\n" . $js_code,
							$oct_output
						);
					}
				}

			}

			$this->output = $oct_output;
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/common/home.php">
		<operation error="skip">
			<search><![CDATA[$data['column_left'] = $this->load->controller('common/column_left');]]></search>
			<add position="before"><![CDATA[
			$this->config->set('oct_deals_vars', array('is_home' => true));
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/product.php">
    	<operation error="skip">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[
			$data['oct_deals_data'] = $oct_deals_data = $this->config->get('theme_oct_deals_data');
			$this->load->model('tool/image');
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$data['description'] = html_entity_decode($product_info['description'], ENT_QUOTES, 'UTF-8');]]></search>
			<add position="after"><![CDATA[
			if (isset($oct_deals_data['preload_images']) && $oct_deals_data['preload_images'] && $product_info['image'] && is_file(DIR_IMAGE . $product_info['image'])) {
				$this->document->setOCTPreload($this->model_tool_image->resize($product_info['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_thumb_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_thumb_height')));
			}
			if (!$this->config->get('config_stock_checkout') || $this->config->get('config_stock_warning')) {
				$data['max_quantity'] = $product_info['quantity'];
			}
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[if ($product_info['quantity'] <= 0) {]]></search>
			<add position="replace"><![CDATA[
			$data['text_oct_popup_found_cheaper'] = $this->language->get('oct_product_cheaper');
       		$data['out_of_stock'] = false;

			if ($product_info['quantity'] <= 0) {
				$data['out_of_stock'] = true;
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[//check product page open from cateory page]]></search>
			<add position="after"><![CDATA[
			if (!isset($oct_deals_data['category_subcat_products'])) {
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[//check product page open from manufacturer page]]></search>
			<add position="before"><![CDATA[
			}
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[$this->document->addScript('catalog/view/javascript/jquery/magnific/jquery.magnific-popup.min.js');]]></search>
			<add position="replace"><![CDATA[
			//$this->document->addScript('catalog/view/javascript/jquery/magnific/jquery.magnific-popup.min.js');
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[$this->document->addStyle('catalog/view/javascript/jquery/magnific/magnific-popup.css');]]></search>
			<add position="replace"><![CDATA[
			//$this->document->addStyle('catalog/view/javascript/jquery/magnific/magnific-popup.css');
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$this->document->addScript('catalog/view/javascript/jquery/datetimepicker/moment/moment.min.js');]]></search>
			<add position="replace"><![CDATA[
			//$this->document->addScript('catalog/view/javascript/jquery/datetimepicker/moment/moment.min.js');
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[$this->document->addScript('catalog/view/javascript/jquery/datetimepicker/moment/moment-with-locales.min.js');]]></search>
			<add position="replace"><![CDATA[
			//$this->document->addScript('catalog/view/javascript/jquery/datetimepicker/moment/moment-with-locales.min.js');
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[$this->document->addScript('catalog/view/javascript/jquery/datetimepicker/bootstrap-datetimepicker.min.js');]]></search>
			<add position="replace"><![CDATA[
			//$this->document->addScript('catalog/view/javascript/jquery/datetimepicker/bootstrap-datetimepicker.min.js');
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[$this->document->addStyle('catalog/view/javascript/jquery/datetimepicker/bootstrap-datetimepicker.min.css');]]></search>
			<add position="replace"><![CDATA[
			//$this->document->addStyle('catalog/view/javascript/jquery/datetimepicker/bootstrap-datetimepicker.min.css');
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[$data['attribute_groups'] = $this->model_catalog_product->getProductAttributes($this->request->get['product_id']);]]></search>
			<add position="before"><![CDATA[

			$this->config->set('footer_swiper', true);

			$this->document->addScript('catalog/view/theme/oct_deals/js/fancybox/jquery.fancybox.min.js');
			$this->document->addStyle('catalog/view/theme/oct_deals/js/fancybox/jquery.fancybox.min.css');

			if (isset($oct_deals_data['product_zoom']) && $oct_deals_data['product_zoom']) {
	            $this->document->addScript('catalog/view/theme/oct_deals/js/zoom/jquery.zoom.js');
        	}

        	$data['sku'] = $product_info['sku'];
			$data['upc'] = $product_info['upc'];
			$data['ean'] = $product_info['ean'];
			$data['jan'] = $product_info['jan'];
			$data['isbn'] = $product_info['isbn'];
			$data['mpn'] = $product_info['mpn'];
			$data['oct_p_reviews'] = $this->load->controller('octemplates/events/helper/octProductReviews');

			$data['oct_product_sku_show'] = $oct_deals_data['product_sku_show'] ?? '';
			$data['oct_product_upc_show'] = $oct_deals_data['product_upc_show'] ?? '';
			$data['oct_product_ean_show'] = $oct_deals_data['product_ean_show'] ?? '';
			$data['oct_product_jan_show'] = $oct_deals_data['product_jan_show'] ?? '';
			$data['oct_product_isbn_show'] = $oct_deals_data['product_isbn_show'] ?? '';
			$data['oct_product_mpn_show'] = $oct_deals_data['product_mpn_show'] ?? '';

			$data['total_reviews'] = (int)$product_info['reviews'];

			$oct_review = $this->model_catalog_review->getOCTReviewsByProductId($product_id);

			$data['oct_rating'] = isset($oct_review['sum']) ? round((float)$oct_review['sum'] / $data['total_reviews'], 1) : 0;

			$data['oct_raiting_stats'][5] = [
				'raiting' => isset($oct_review['rating'][5]) ? round(count($oct_review['rating'][5])/$data['total_reviews']*100) : 0,
				'sum' => isset($oct_review['rating'][5]) ? (int)count($oct_review['rating'][5]) : 0
			];

			$data['oct_raiting_stats'][4] = [
				'raiting' => isset($oct_review['rating'][4]) ? round(count($oct_review['rating'][4])/$data['total_reviews']*100) : 0,
				'sum' => isset($oct_review['rating'][4]) ? (int)count($oct_review['rating'][4]) : 0
			];

			$data['oct_raiting_stats'][3] = [
				'raiting' => isset($oct_review['rating'][3]) ? round(count($oct_review['rating'][3])/$data['total_reviews']*100) : 0,
				'sum' => isset($oct_review['rating'][3]) ? (int)count($oct_review['rating'][3]) : 0
			];

			$data['oct_raiting_stats'][2] = [
				'raiting' => isset($oct_review['rating'][2]) ? round(count($oct_review['rating'][2])/$data['total_reviews']*100) : 0,
				'sum' => isset($oct_review['rating'][2]) ? (int)count($oct_review['rating'][2]) : 0
			];

			$data['oct_raiting_stats'][1] = [
				'raiting' => isset($oct_review['rating'][1]) ? round(count($oct_review['rating'][1])/$data['total_reviews']*100) : 0,
				'sum' => isset($oct_review['rating'][1]) ? (int)count($oct_review['rating'][1]) : 0
			];
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[$results = $this->model_catalog_product->getProductImages($this->request->get['product_id']);]]></search>
			<add position="after"><![CDATA[
			if ($data['popup'] && $data['thumb'] && !empty($results)) {
				$data['images'][0] = array(
					'popup' => $data['thumb'],
					'popup_fancy' => $this->model_tool_image->resize($product_info['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_popup_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_popup_height')),
					'thumb' => $this->model_tool_image->resize($product_info['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_additional_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_additional_height')),
					'images_width' => $this->config->get('theme_' . $this->config->get('config_theme') . '_image_additional_width'),
					'images_height' => $this->config->get('theme_' . $this->config->get('config_theme') . '_image_additional_height'),
				);
			}
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$data['images'] = array();]]></search>
			<add position="before"><![CDATA[
			$data['popup_width'] = $this->config->get('theme_' . $this->config->get('config_theme') . '_image_popup_width');
			$data['popup_height'] = $this->config->get('theme_' . $this->config->get('config_theme') . '_image_popup_height');
			$data['thumb_width'] = $this->config->get('theme_' . $this->config->get('config_theme') . '_image_thumb_width');
			$data['thumb_height'] = $this->config->get('theme_' . $this->config->get('config_theme') . '_image_thumb_height');
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$data['popup'] = '';]]></search>
			<add position="replace"><![CDATA[
			$data['popup'] = $this->model_tool_image->resize('no-thumb.png', $this->config->get('theme_' . $this->config->get('config_theme') . '_image_popup_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_popup_height'));
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$data['thumb'] = '';]]></search>
			<add position="replace"><![CDATA[
			$data['thumb'] = $this->model_tool_image->resize('no-thumb.png', $this->config->get('theme_' . $this->config->get('config_theme') . '_image_thumb_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_thumb_height'));
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA['popup' => $this->model_tool_image->resize($result['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_popup_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_popup_height')),]]></search>
			<add position="replace"><![CDATA[
			'popup' => $this->model_tool_image->resize($result['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_thumb_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_thumb_height')),
			'popup_fancy' => $this->model_tool_image->resize($result['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_popup_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_popup_height')),
			'images_width' => $this->config->get('theme_' . $this->config->get('config_theme') . '_image_additional_width'),
			'images_height' => $this->config->get('theme_' . $this->config->get('config_theme') . '_image_additional_height'),
			]]></add>
    	</operation>
    	<operation>
	    	<search><![CDATA[$data['review_status'] = $this->config->get('config_review_status');]]></search>
			<add position="after"><![CDATA[
			$data['oct_reviews_list'] = $data['review_status'] ? $this->review() : '';
			]]></add>
    	</operation>
    	<operation>
	    	<search><![CDATA[public function review() {]]></search>
			<add position="after"><![CDATA[
			if (isset($this->request->post['product_id']) && !empty($this->request->post['product_id'])) {
				$this->request->get['product_id'] = $this->request->post['product_id'];
			}
			]]></add>
    	</operation>
		<operation>
	    	<search><![CDATA[$data['reviews'] = array();]]></search>
			<add position="after"><![CDATA[
			$this->load->model('octemplates/helper');
			]]></add>
    	</operation>
		<operation>
	    	<search><![CDATA[$data['reviews'][] = array(]]></search>
			<add position="before"><![CDATA[
			$oct_review_data = $this->model_octemplates_helper->getOctReviewData($result['review_id']);
			]]></add>
		</operation>
		<operation>
	    	<search><![CDATA['author'     => $result['author'],]]></search>
			<add position="after"><![CDATA[
			'positive_text' => isset($oct_review_data['positive_text']) ? $oct_review_data['positive_text'] : '',
            'negative_text' => isset($oct_review_data['negative_text']) ? $oct_review_data['negative_text'] : '',
            'admin_answer'  => isset($oct_review_data['admin_answer']) ? nl2br($oct_review_data['admin_answer']) : '',
			'positive_votes' => isset($oct_review_data['positive_votes']) ? $oct_review_data['positive_votes'] : 0,
			'review_id' => $result['review_id'],
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$json['error'] = $this->language->get('error_name');]]></search>
			<add position="replace"><![CDATA[$json['error']['name'] = $this->language->get('error_name');]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[$json['error'] = $this->language->get('error_text');]]></search>
			<add position="replace"><![CDATA[$json['error']['text'] = $this->language->get('error_text');]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[$json['error'] = $this->language->get('error_rating');]]></search>
			<add position="replace"><![CDATA[$json['error']['rating'] = $this->language->get('error_rating');]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[$json['error'] = $captcha;]]></search>
			<add position="replace"><![CDATA[$json['error']['captcha'] = $captcha;]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA['date_added' => date($this->language->get('date_format_short'), strtotime($result['date_added']))]]></search>
			<add position="replace"><![CDATA['date_added' => $this->load->controller('octemplates/main/oct_functions/OctDateTime', array($result['date_added'], 1))]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/common/{content_top,column_left,column_right,content_bottom}.php">
		<operation error="skip">
			<search><![CDATA[if ($setting_info && $setting_info['status']) {]]></search>
			<add position="replace"><![CDATA[
			if ($setting_info && isset($setting_info['status']) && $setting_info['status']) {
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/common/cart.php">
		<operation error="skip">
			<search><![CDATA[$data['text_items'] = sprintf($this->language->get('text_items'), $this->cart->countProducts() + (isset($this->session->data['vouchers']) ? count($this->session->data['vouchers']) : 0), $this->currency->format($total, $this->session->data['currency']));]]></search>
			<add position="after"><![CDATA[
			$data['total_products'] = $this->cart->countProducts() + (isset($this->session->data['vouchers']) ? count($this->session->data['vouchers']) : 0);
			$data['total_amount'] = $this->currency->format($total, $this->session->data['currency']);
			$data['oct_popup_cart_status'] = $this->config->get('theme_oct_deals_popup_cart_status');
			$product_ids = [];
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[foreach ($this->cart->getProducts() as $product) {]]></search>
			<add position="after"><![CDATA[
			 $product_ids[] = $product['product_id'];
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[return $this->load->view('common/cart', $data);]]></search>
			<add position="before"><![CDATA[
			$data['cart_product_ids'] = implode(",", $product_ids);
			$data['oct_deals_data'] = $this->config->get('theme_oct_deals_data');
			$data['isbuttoninteractive'] = isset($data['oct_deals_data']['isbuttoninteractive']) ? true : false;
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/information/information.php">
		<operation error="skip">
			<search><![CDATA[$data['description'] = html_entity_decode($information_info['description'], ENT_QUOTES, 'UTF-8');]]></search>
			<add position="replace"><![CDATA[
			$info_description = str_replace("<img", "<img class='img-fluid'", html_entity_decode($information_info['description'], ENT_QUOTES, 'UTF-8'));

			$data['description'] = $info_description;
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/product/compare.php">
		<operation error="skip">
			<search><![CDATA[$json['total'] = sprintf($this->language->get('text_compare'), (isset($this->session->data['compare']) ? count($this->session->data['compare']) : 0));]]></search>
			<add position="after"><![CDATA[
			$json['total_compare'] = (isset($this->session->data['compare']) ? count($this->session->data['compare']) : 0);
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$data['attribute_groups'] = array();]]></search>
			<add position="after"><![CDATA[
			// Stock Notify
			if ($this->config->get('oct_stock_notifier_status')) {
				$data['oct_stock_notifier_status'] = $this->config->get('oct_stock_notifier_status');
			}
			]]></add>
    	</operation>		
		<operation error="skip">
			<search><![CDATA[$attribute_data = array();]]></search>
			<add position="after"><![CDATA[
			    $can_buy = true;

                if ($product_info['quantity'] <= 0 && !$this->config->get('config_stock_checkout')) {
                    $can_buy = false;
                } elseif ($product_info['quantity'] <= 0 && $this->config->get('config_stock_checkout')) {
                    $can_buy = true;
                }
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA['special'      => $special,]]></search>
			<add position="after"><![CDATA[
			    'can_buy'     => $can_buy,
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/account/wishlist.php">
		<operation error="skip">
			<search><![CDATA[$this->load->model('tool/image');]]></search>
			<add position="after"><![CDATA[
				// Stock Notify
				if ($this->config->get('oct_stock_notifier_status')) {
					$data['oct_stock_notifier_status'] = $this->config->get('oct_stock_notifier_status');
				}
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[if ((float)$product_info['special']) {]]></search>
			<add position="before"><![CDATA[
				$can_buy = true;

                if ($product_info['quantity'] <= 0 && !$this->config->get('config_stock_checkout')) {
                    $can_buy = false;
                } elseif ($product_info['quantity'] <= 0 && $this->config->get('config_stock_checkout')) {
                    $can_buy = true;
                }
			]]></add>
    	</operation>		
		<operation error="skip">
			<search><![CDATA['stock'      => $stock,]]></search>
			<add position="after"><![CDATA[
			    'can_buy'     => $can_buy,
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[if (!$this->customer->isLogged()) {]]></search>
			<add position="replace"><![CDATA[
			if (!$this->customer->isLogged() && !$this->config->get('theme_oct_deals_status')) {
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[if (isset($this->request->get['remove'])) {]]></search>
			<add position="after"><![CDATA[
			if ($this->customer->isLogged()) {
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$this->response->redirect($this->url->link('account/wishlist'));]]></search>
			<add position="after"><![CDATA[
			} else {
				if (isset($this->session->data['wishlist'])) {
					$oct_w_key = array_keys($this->session->data['wishlist'], $this->request->get['remove']);

					if (!empty($oct_w_key) && isset($oct_w_key[0])) {
						unset($this->session->data['wishlist'][$oct_w_key[0]]);

						$this->session->data['success'] = $this->language->get('text_remove');

						$this->response->redirect($this->url->link('account/wishlist'));
					}
				}
			}
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$results = $this->model_account_wishlist->getWishlist();]]></search>
			<add position="replace"><![CDATA[
			$results = $this->customer->isLogged() ? $this->model_account_wishlist->getWishlist() : ((isset($this->session->data['wishlist']) && !empty($this->session->data['wishlist'])) ? $this->session->data['wishlist'] : []);
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$product_info = $this->model_catalog_product->getProduct($result['product_id']);]]></search>
			<add position="replace"><![CDATA[
			$product_info = $this->model_catalog_product->getProduct(isset($result['product_id']) ? $result['product_id'] : $result);
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$json['total'] = sprintf($this->language->get('text_wishlist'), (isset($this->session->data['wishlist']) ? count($this->session->data['wishlist']) : 0));]]></search>
			<add position="after"><![CDATA[
			$json['total_wishlist'] = (isset($this->session->data['wishlist']) ? count($this->session->data['wishlist']) : 0);
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[$json['total'] = sprintf($this->language->get('text_wishlist'), $this->model_account_wishlist->getTotalWishlist());]]></search>
			<add position="after"><![CDATA[
			$json['total_wishlist'] = $this->model_account_wishlist->getTotalWishlist();
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[$json['success'] = sprintf($this->language->get('text_login'), $this->url->link('account/login', '', true), $this->url->link('account/register', '', true), $this->url->link('product/product', 'product_id=' . (int)$this->request->post['product_id']), $product_info['name'], $this->url->link('account/wishlist'));]]></search>
			<add position="replace"><![CDATA[
			$json['success'] = sprintf($this->language->get('text_success'), $this->url->link('product/product', 'product_id=' . (int)$this->request->post['product_id']), $product_info['name'], $this->url->link('account/wishlist'));
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/common/language.php">
		<operation error="skip">
			<search><![CDATA['name' => $result['name'],]]></search>
			<add position="after"><![CDATA[
			'oct_template_code' => substr(str_replace("uk", "ua", $result['code']), 0, 2),
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/checkout/cart.php">
		<operation error="skip">
			<search><![CDATA[$products = $this->cart->getProducts();]]></search>
			<add position="after"><![CDATA[
			if (($this->config->get('config_checkout_guest') && $this->config->get('oct_popup_purchase_byoneclick_status')) && $products) {
				$oct_byoneclick_data = $this->config->get('oct_popup_purchase_byoneclick_data');
				$oct_data['oct_byoneclick_status'] = isset($oct_byoneclick_data['cart']) ? 1 : 0;
				$oct_data['oct_byoneclick_mask'] = $oct_byoneclick_data['mask'];
				$oct_data['oct_byoneclick_product_id'] = $oct_data['oct_cart_in'] = $oct_data['oct_cart_page'] = 1;
				$oct_data['oct_byoneclick_page'] = '_cart';
				$data['oct_byoneclick'] = $this->load->controller('octemplates/module/oct_popup_purchase/byoneclick', $oct_data);
			}
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$json['total'] = sprintf($this->language->get('text_items'), $this->cart->countProducts() + (isset($this->session->data['vouchers']) ? count($this->session->data['vouchers']) : 0), $this->currency->format($total, $this->session->data['currency']));]]></search>
			<add position="after"><![CDATA[
			$json['oct_cart_ids'] = $this->load->controller('octemplates/events/helper/allCartProducts');
			$json['isPopup'] = ($this->config->get('theme_oct_deals_popup_cart_status') && $this->config->get('theme_oct_deals_isPopup')) ? 1 : 0;
			$json['total_products'] = $this->cart->countProducts() + (isset($this->session->data['vouchers']) ? count($this->session->data['vouchers']) : 0);
			$json['total_amount'] = $this->currency->format($total, $this->session->data['currency']);
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$this->cart->add($this->request->post['product_id'], $quantity, $option, $recurring_id);]]></search>
			<add position="before" offset="1"><![CDATA[
			if ((!$product_info['quantity'] || ($product_info['quantity'] < $quantity)) && (!$this->config->get('config_stock_checkout') || $this->config->get('config_stock_warning'))) {
				if	($product_info['quantity'] < 1) {
					$json['error']['error_warning'] = $this->language->get('error_no_stock');
				} else {
					$json['error']['error_warning'] = sprintf($this->language->get('error_limited_stock'), $product_info['quantity']);
				}
			}
			]]></add>
    	</operation>
		<operation error="skip">
			<search index="0"><![CDATA[$json['total_amount'] = $this->currency->format($total, $this->session->data['currency']);]]></search>
			<add position="after"><![CDATA[
			} elseif (isset($json['error']['error_warning']) && $json['error']['error_warning']) {
				$json['error']['error_warning'];]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$this->response->setOutput($this->load->view('error/not_found', $data));]]></search>
			<add position="replace"><![CDATA[
			$this->response->setOutput($this->load->view('octemplates/checkout/cart_empty', $data));
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/product/{category,manufacturer,search,special}.php">
		<operation error="skip">
			<search><![CDATA[public function info() {]]></search>
			<add position="after"><![CDATA[
			$data['oct_deals_data'] = $oct_deals_data = $this->config->get('theme_oct_deals_data');

			$data['oct_infinite_scroll_status'] = isset($oct_deals_data['category_infinite_scroll']) ? $oct_deals_data['category_infinite_scroll'] : 0;
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[
			$data['oct_deals_data'] = $oct_deals_data = $this->config->get('theme_oct_deals_data');

			$data['oct_infinite_scroll_status'] = isset($oct_deals_data['category_infinite_scroll']) ? $oct_deals_data['category_infinite_scroll'] : 0;

			if (isset($oct_deals_data['category_view_sort_oder']) && $oct_deals_data['category_view_sort_oder']) {
				$oct_deals_sort_data = $this->config->get('theme_oct_deals_sort_data');

				if (isset($oct_deals_sort_data['deff_sort']) && $oct_deals_sort_data['deff_sort']) {
					$sort_order = explode('-', $oct_deals_sort_data['deff_sort']);
				}
			}

			$ikey = 1;
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[if ($this->customer->isLogged() || !$this->config->get('config_customer_price')) {]]></search>
			<add position="before"><![CDATA[
			if (isset($oct_deals_data['preload_images']) && $oct_deals_data['preload_images'] && $ikey <= 1) {
				$this->document->setOCTPreload($image);
			}

			$ikey++;
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$sort = 'p.sort_order';]]></search>
			<add position="replace"><![CDATA[
			$sort = (isset($sort_order) && !empty($sort_order) && isset($sort_order[0])) ? $sort_order[0] : 'p.sort_order';
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$order = 'ASC';]]></search>
			<add position="replace"><![CDATA[
			$order = (isset($sort_order) && !empty($sort_order) && isset($sort_order[1])) ? $sort_order[1] : 'ASC';
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$result['rating'],]]></search>
			<add position="replace"><![CDATA[
			$this->config->get('config_review_status') ? $result['rating'] : false,
			'oct_model'	  => $this->config->get('theme_oct_deals_data_model') ? $result['model'] : '',
			'reviews'	  => $result['reviews'],
			'quantity'	  => $result['quantity'] <= 0 ? true : false,
			'width'		  => $this->config->get('theme_' . $this->config->get('config_theme') . '_image_product_width'),
			'height'	  => $this->config->get('theme_' . $this->config->get('config_theme') . '_image_product_height'),
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/product/category.php">
		<operation error="skip">
			<search index="0"><![CDATA[foreach ($results as $result) {]]></search>
			<add position="after"><![CDATA[
			if ($result['image'] && file_exists(DIR_IMAGE.$result['image'])) {
				$cat_image = $this->model_tool_image->resize($result['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_sub_category_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_sub_category_height'));
			} else {
				$cat_image = $this->model_tool_image->resize('placeholder.png', $this->config->get('theme_' . $this->config->get('config_theme') . '_image_sub_category_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_sub_category_height'));
			}
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA['href' => $this->url->link('product/category', 'path=' . $this->request->get['path'] . '_' . $result['category_id'] . $url)]]></search>
			<add position="before"><![CDATA[
			'image'		=> $cat_image,
			'width'		=> $this->config->get('theme_' . $this->config->get('config_theme') . '_image_sub_category_width'),
			'height'	=> $this->config->get('theme_' . $this->config->get('config_theme') . '_image_sub_category_height'),
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[if ($category_info['image']) {]]></search>
			<add position="replace"><![CDATA[
			if ($category_info['image'] && (isset($oct_deals_data['category_cat_image']) && $oct_deals_data['category_cat_image'])) {
				$data['cat_image_width'] = $this->config->get('theme_' . $this->config->get('config_theme') . '_image_category_width');
				$data['cat_image_height'] = $this->config->get('theme_' . $this->config->get('config_theme') . '_image_category_height');
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[$data['description'] = html_entity_decode($category_info['description'], ENT_QUOTES, 'UTF-8');]]></search>
			<add position="after"><![CDATA[
			if (!isset($oct_deals_data['category_desc_in_page']) && $page > 1) {
				$data['description'] = false;
				$data['thumb'] = false;
			} else {
				$data['description'] = str_replace("<img", "<img class='img-fluid'", html_entity_decode($category_info['description'], ENT_QUOTES, 'UTF-8'));
			}

			$data['language_id'] = (int)$this->config->get('config_language_id');
			$data['categories_page'] = (isset($oct_deals_data['category_page']) && $oct_deals_data['category_page']) ? unserialize($category_info['page_group_links']) : [];
			]]></add>
    	</operation>
    	<operation error="skip">
			<search index="0"><![CDATA[$data['categories'] = array();]]></search>
			<add position="after"><![CDATA[
			if(isset($oct_deals_data['category_view_subcats']) && $oct_deals_data['category_view_subcats'] == 'on'){
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[$data['products'] = array();]]></search>
			<add position="before"><![CDATA[
			}
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA['filter_filter'      => $filter,]]></search>
			<add position="before"><![CDATA[
			'filter_sub_category' => (isset($oct_deals_data['category_subcat_products']) && $oct_deals_data['category_subcat_products'] == 'on') ? true : false,
			]]></add>
		</operation>
    	<operation error="skip">
			<search><![CDATA[$results = $this->model_catalog_category->getCategories($category_id);]]></search>
			<add position="before"><![CDATA[
			if(isset($this->request->server['HTTP_ACCEPT']) && strpos($this->request->server['HTTP_ACCEPT'], 'webp')) {
				$oct_webP = 1 . '-' . $this->session->data['currency'];
			} else {
				$oct_webP = 0 . '-' . $this->session->data['currency'];
			}

			$oct_categories = $this->cache->get('octemplates.sub_categories.' . (int)$this->config->get('config_language_id') . '.' . (int)$this->config->get('config_store_id') . '.' . $this->config->get('config_customer_group_id') . '.' . (int)$category_id . '.' . $oct_webP);

			if (!$oct_categories) {
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA['href' => $this->url->link('product/category', 'path=' . $this->request->get['path'] . '_' . $result['category_id'] . $url)]]></search>
			<add position="after" offset="2"><![CDATA[
				$oct_categories = $data['categories'];

				$this->cache->set('octemplates.sub_categories.' . (int)$this->config->get('config_language_id') . '.' . (int)$this->config->get('config_store_id') . '.' . $this->config->get('config_customer_group_id') . '.' . (int)$category_id . '.' . $oct_webP, $oct_categories);
			}

			$data['categories'] = $oct_categories;
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA['href'  => $this->url->link('product/category', 'path=' . $this->request->get['path'] . '&sort=p.model&order=DESC' . $url)]]></search>
			<add position="after" offset="1"><![CDATA[
			if ((isset($oct_deals_sort_data) && !empty($oct_deals_sort_data)) && (isset($oct_deals_sort_data['sort']) && !empty($oct_deals_sort_data['sort']))) {
				$data['sorts'] = [];

				foreach ($oct_deals_sort_data['sort'] as $oct_sort) {
					$sort_order = explode('-', $oct_sort);

					$sort_name = str_replace(['.','-'], ['_', '_'], $oct_sort);

					if (!$this->config->get('config_review_status') && $sort_order[0] == 'rating') {
						continue;
					}

					$data['sorts'][] = array(
						'text'  => $this->language->get('text_' . $sort_name),
						'value' => $oct_sort,
						'href'  => $this->url->link('product/category', 'path=' . $this->request->get['path'] . '&sort=' . $sort_order[0] . '&order='. $sort_order[1] . $url)
					);
				}
			}
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/product/search.php">
		<operation error="skip">
			<search><![CDATA['href'  => $this->url->link('product/search', 'sort=p.model&order=DESC' . $url)]]></search>
			<add position="after" offset="1"><![CDATA[
			if ((isset($oct_deals_sort_data) && !empty($oct_deals_sort_data)) && (isset($oct_deals_sort_data['sort']) && !empty($oct_deals_sort_data['sort']))) {
				$data['sorts'] = [];

				foreach ($oct_deals_sort_data['sort'] as $oct_sort) {
					$sort_order = explode('-', $oct_sort);

					$sort_name = str_replace(['.','-'], ['_', '_'], $oct_sort);

					if (!$this->config->get('config_review_status') && $sort_order[0] == 'rating') {
						continue;
					}

					$data['sorts'][] = array(
						'text'  => $this->language->get('text_' . $sort_name),
						'value' => $oct_sort,
						'href'  => $this->url->link('product/search', '&sort=' . $sort_order[0] . '&order='. $sort_order[1] . $url)
					);
				}
			}
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/product/special.php">
		<operation error="skip">
			<search><![CDATA['href'  => $this->url->link('product/special', 'sort=p.model&order=DESC' . $url)]]></search>
			<add position="after" offset="1"><![CDATA[
			if ((isset($oct_deals_sort_data) && !empty($oct_deals_sort_data)) && (isset($oct_deals_sort_data['sort']) && !empty($oct_deals_sort_data['sort']))) {
				$data['sorts'] = [];

				foreach ($oct_deals_sort_data['sort'] as $oct_sort) {
					$sort_order = explode('-', $oct_sort);

					$sort_name = str_replace(['.','-'], ['_', '_'], $oct_sort);

					if (!$this->config->get('config_review_status') && $sort_order[0] == 'rating') {
						continue;
					}

					$data['sorts'][] = array(
						'text'  => $this->language->get('text_' . $sort_name),
						'value' => $oct_sort,
						'href'  => $this->url->link('product/special', '&sort=' . $sort_order[0] . '&order='. $sort_order[1] . $url)
					);
				}
			}
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/product/manufacturer.php">
		<operation error="skip">
			<search><![CDATA[public function info() {]]></search>
			<add position="after"><![CDATA[
			$data['oct_deals_data'] = $oct_deals_data = $this->config->get('theme_oct_deals_data');

			if (isset($oct_deals_data['category_view_sort_oder']) && $oct_deals_data['category_view_sort_oder']) {
				$oct_deals_sort_data = $this->config->get('theme_oct_deals_sort_data');

				if (isset($oct_deals_sort_data['deff_sort']) && $oct_deals_sort_data['deff_sort']) {
					$sort_order = explode('-', $oct_deals_sort_data['deff_sort']);
				}
			}

			$ikey = 1;
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$data['categories'][$key]['manufacturer'][] = array(]]></search>
			<add position="before"><![CDATA[
			if (isset($oct_deals_data['man_logo']) && $oct_deals_data['man_logo'] == 'on') {
				$this->load->model('tool/image');
				if ($result['image'] && is_file(DIR_IMAGE . $result['image'])) {
					$image = $this->model_tool_image->resize($result['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_manufacturer_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_manufacturer_height'));
				} else {
					$image = $this->model_tool_image->resize('placeholder.png', $this->config->get('theme_' . $this->config->get('config_theme') . '_image_manufacturer_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_manufacturer_height'));
				}
			} else {
				$image = false;
			}
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA['href' => $this->url->link('product/manufacturer/info', 'manufacturer_id=' . $result['manufacturer_id'])]]></search>
			<add position="before"><![CDATA[
			'image'		=> $image,
			'width'		=> $this->config->get('theme_' . $this->config->get('config_theme') . '_image_manufacturer_width'),
			'height'	=> $this->config->get('theme_' . $this->config->get('config_theme') . '_image_manufacturer_height'),
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA['href'  => $this->url->link('product/manufacturer/info', 'manufacturer_id=' . $this->request->get['manufacturer_id'] . '&sort=p.model&order=DESC' . $url)]]></search>
			<add position="after" offset="1"><![CDATA[
			if ((isset($oct_deals_sort_data) && !empty($oct_deals_sort_data)) && (isset($oct_deals_sort_data['sort']) && !empty($oct_deals_sort_data['sort']))) {
				$data['sorts'] = [];

				foreach ($oct_deals_sort_data['sort'] as $oct_sort) {
					$sort_order = explode('-', $oct_sort);

					$sort_name = str_replace(['.','-'], ['_', '_'], $oct_sort);

					if (!$this->config->get('config_review_status') && $sort_order[0] == 'rating') {
						continue;
					}

					$data['sorts'][] = array(
						'text'  => $this->language->get('text_' . $sort_name),
						'value' => $oct_sort,
						'href'  => $this->url->link('product/manufacturer/info', 'manufacturer_id=' . $this->request->get['manufacturer_id'] . '&sort=' . $sort_order[0] . '&order='. $sort_order[1] . $url)
					);
				}
			}
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/extension/module/{slideshow,carousel}.php">
		<operation error="skip">
			<search><![CDATA[$this->document->addStyle('catalog/view/javascript/jquery/swiper/css/swiper.min.css');]]></search>
			<add position="replace"><![CDATA[
			$this->config->set('footer_swiper', true);
			]]>
			</add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$this->document->addStyle('catalog/view/javascript/jquery/swiper/css/opencart.css');]]></search>
			<add position="replace"><![CDATA[
			//$this->document->addStyle('catalog/view/javascript/jquery/swiper/css/opencart.css');
			]]></add>
    	</operation>
		<operation error="skip">
			<search regex="true"><![CDATA[(.*swiper.jquery.*)]]></search>
			<add position="replace"><![CDATA[
			$this->config->set('footer_swiper', true);
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/information/contact.php">
		<operation error="skip">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[
			$oct_deals_data = $this->config->get('theme_oct_deals_data');

			if ((isset($oct_deals_data['contact_view_map']) && $oct_deals_data['contact_view_map'] == 'on') && (isset($oct_deals_data['contact_map']) && !empty($oct_deals_data['contact_map']))) {
				$data['contact_map'] = html_entity_decode($oct_deals_data['contact_map'], ENT_QUOTES, 'UTF-8');
			}

			if ((isset($oct_deals_data['contact_view_socials']) && $oct_deals_data['contact_view_socials'] == 'on') && (isset($oct_deals_data['socials']) && !empty($oct_deals_data['socials']))) {
				$data['contact_socials'] = $oct_deals_data['socials'];
			}

			if ((isset($oct_deals_data['contact_view_phone']) && $oct_deals_data['contact_view_phone'] == 'on') && (isset($oct_deals_data['contact_telephone']) && !empty($oct_deals_data['contact_telephone']))) {
				$oct_contact_telephones = explode(PHP_EOL, $oct_deals_data['contact_telephone']);

				foreach ($oct_contact_telephones as $oct_contact_telephone) {
					if (!empty($oct_contact_telephone)) {
						$data['contact_telephone'][] = html_entity_decode(trim($oct_contact_telephone), ENT_QUOTES, 'UTF-8');
					}
				}
			}

			if ((isset($oct_deals_data['contact_view_time']) && $oct_deals_data['contact_view_time'] == 'on') && (isset($oct_deals_data['contact_open'][(int)$this->config->get('config_language_id')]) && !empty($oct_deals_data['contact_open'][(int)$this->config->get('config_language_id')]))) {
				$oct_contact_opens = explode(PHP_EOL, $oct_deals_data['contact_open'][(int)$this->config->get('config_language_id')]);

				foreach ($oct_contact_opens as $oct_contact_open) {
					if (!empty($oct_contact_open)) {
						$data['contact_open'][] = html_entity_decode($oct_contact_open, ENT_QUOTES, 'UTF-8');
					}
				}
			}

			if ((isset($oct_deals_data['contact_view_address']) && $oct_deals_data['contact_view_address'] == 'on') && (isset($oct_deals_data['contact_address'][(int)$this->config->get('config_language_id')]) && !empty($oct_deals_data['contact_address'][(int)$this->config->get('config_language_id')]))) {
				$data['contact_address'] = html_entity_decode($oct_deals_data['contact_address'][(int)$this->config->get('config_language_id')], ENT_QUOTES, 'UTF-8');
			}

			if (isset($oct_deals_data['contact_view_html'][(int)$this->config->get('config_language_id')]) && !empty(strip_tags($oct_deals_data['contact_view_html'][(int)$this->config->get('config_language_id')]))) {
				$data['contact_html'] = html_entity_decode($oct_deals_data['contact_view_html'][(int)$this->config->get('config_language_id')], ENT_QUOTES, 'UTF-8');
			}

			if ($this->config->get('config_account_id')) {
	            $this->load->model('catalog/information');

				$this->load->language('octemapltes/oct_subscripe');

				$data['scales_in'] = isset($this->request->post['scales']) ? 1 : 0;

	            $information_info = $this->model_catalog_information->getInformation($this->config->get('config_account_id'));

	            if ($information_info) {
	                $data['text_terms'] = sprintf($this->language->get('text_oct_terms'), $this->url->link('information/information', 'information_id=' . $this->config->get('config_account_id'), 'SSL'), $information_info['title'], $information_info['title']);
	            } else {
	                $data['text_terms'] = '';
	            }
	        } else {
	            $data['text_terms'] = '';
	        }

			if (isset($oct_deals_data['contact_view_locations']) && $oct_deals_data['contact_view_locations'] == 'on') {
				$this->load->model('octemplates/widgets/oct_locations');

				$data['oct_locations'] = $this->model_octemplates_widgets_oct_locations->getOCTLocations();
			}

			if (isset($oct_deals_data['contact_image']) && !empty($oct_deals_data['contact_image']) && file_exists(DIR_IMAGE.$oct_deals_data['contact_image'])) {
				$this->load->model('tool/image');

				$data['oct_contact_image'] = $this->model_tool_image->resize($oct_deals_data['contact_image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_location_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_location_height'));
			}
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$data['continue'] = $this->url->link('common/home');]]></search>
			<add position="before"><![CDATA[
			$data['text_message'] = $this->language->get('text_message_contact');
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$data['button_submit'] = $this->language->get('button_submit');]]></search>
			<add position="before"><![CDATA[
			if (isset($this->error['scales'])) {
				$data['error_oct_terms'] = $this->error['scales'];
			} else {
				$data['error_oct_terms'] = '';
			}
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[return !$this->error;]]></search>
			<add position="before"><![CDATA[
	        if ($this->config->get('config_account_id') && !isset($this->request->post['scales'])) {
	            $this->load->model('catalog/information');

	            $information_info = $this->model_catalog_information->getInformation($this->config->get('config_account_id'));

	            $this->error['scales'] = sprintf($this->language->get('error_oct_terms'), $information_info['title']);
	        }
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/common/maintenance.php">
		<operation error="skip">
			<search><![CDATA[$data['message'] = $this->language->get('text_message');]]></search>
			<add position="before"><![CDATA[
			$data['title'] = $this->language->get('text_maintenance');
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$data['header'] = $this->load->controller('common/header');]]></search>
			<add position="replace"><![CDATA[
			//$data['header'] = $this->load->controller('common/header');
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$data['footer'] = $this->load->controller('common/footer');]]></search>
			<add position="replace"><![CDATA[
			//$data['footer'] = $this->load->controller('common/footer');
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/extension/module/{banner,slideshow,carousel}.php">
		<operation error="skip">
			<search><![CDATA['image' => $this->model_tool_image->resize($result['image'], $setting['width'], $setting['height'])]]></search>
			<add position="before"><![CDATA[
			'width'		=> $setting['width'],
			'height'	=> $setting['height'],
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/extension/module/{featured,bestseller,latest,special}.php">
    	<operation error="skip">
			<search><![CDATA[$data['products'] = array();]]></search>
			<add position="before"><![CDATA[
			$data['oct_popup_view_status'] = $this->config->get('oct_popup_view_status');
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/product/{category,manufacturer,product,search,special}.php">
    	<operation error="skip">
			<search><![CDATA[$data['products'] = array();]]></search>
			<add position="after"><![CDATA[
			$data['oct_popup_view_status'] = $this->config->get('oct_popup_view_status');
			]]></add>
    	</operation>
	</file>
	<file path="catalog/model/catalog/product.php">
		<operation error="skip">
			<search><![CDATA[public function getProductAttributes($product_id) {]]></search>
			<add position="before"><![CDATA[
	        public function getOctProductAttributes($product_id, $limit = 5) {
		        $product_attribute_data = [];

				$product_attribute_query = $this->db->query("SELECT a.attribute_id, ad.name, pa.text FROM " . DB_PREFIX . "product_attribute pa LEFT JOIN " . DB_PREFIX . "attribute a ON (pa.attribute_id = a.attribute_id) LEFT JOIN " . DB_PREFIX . "attribute_description ad ON (a.attribute_id = ad.attribute_id) WHERE pa.product_id = '" . (int)$product_id . "' AND ad.language_id = '" . (int)$this->config->get('config_language_id') . "' AND pa.language_id = '" . (int)$this->config->get('config_language_id') . "' ORDER BY a.sort_order, ad.name LIMIT " . (int)$limit);

				foreach ($product_attribute_query->rows as $product_attribute) {
					$product_attribute_data[] = [
						'attribute_id' => $product_attribute['attribute_id'],
						'name'         => $product_attribute['name'],
						'text'         => $product_attribute['text']
					];
				}

				return $product_attribute_data;
			}
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/product/{category,manufacturer,search,special}.php">
		<operation error="skip">
			<search><![CDATA[$data['products'] = array();]]></search>
			<add position="after"><![CDATA[
	        $oct_deals_data_atributes = $this->config->get('theme_oct_deals_data_atributes');
			$data['oct_stock_notifier_status'] = $this->config->get('oct_stock_notifier_status');  
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[$data['products'][] = array(]]></search>
			<add position="before"><![CDATA[
			$oct_atributes = false;

			if (isset($oct_deals_data_atributes) && $oct_deals_data_atributes) {
				$limit_attr  = $this->config->get('theme_oct_deals_data_cat_atr_limit') ? $this->config->get('theme_oct_deals_data_cat_atr_limit') : 5;

				$oct_atributes = $this->model_catalog_product->getOctProductAttributes(isset($product_info) ? $product_info['product_id'] : $result['product_id'], $limit_attr);
			}

			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA['thumb'       => $image,]]></search>
			<add position="after"><![CDATA[
			'oct_atributes'       => $oct_atributes,
			]]></add>
    	</operation>
	</file>
		<file path="catalog/model/tool/image.php">
		<operation error="skip">
			<search><![CDATA[$image_new = str_replace(' ', '%20', $image_new);]]></search>
			<add position="before"><![CDATA[
			$oct_webp_image = $octWebpIs = false;

			$gd = gd_info();

			if (isset($gd['WebP Support']) && $gd['WebP Support'] && (isset($this->request->server['HTTP_ACCEPT']) && strpos($this->request->server['HTTP_ACCEPT'], 'webp')) && $this->config->get('theme_oct_deals_webp')) {
				$octWebpIs = true;
			}

			if ($octWebpIs && $extension != 'gif') {
				$oct_webp_image = 'cache/webp/' . utf8_substr($filename, 0, utf8_strrpos($filename, '.')) . '-' . (int)$width . 'x' . (int)$height . '.webp';

				if (!is_file(DIR_IMAGE . $oct_webp_image) || (filemtime(DIR_IMAGE . $image_new) > filemtime(DIR_IMAGE . $oct_webp_image))) {
					$path = '';

					$directories = explode('/', dirname($oct_webp_image));

					foreach ($directories as $directory) {
						$path = $path . '/' . $directory;

						if (!is_dir(DIR_IMAGE . $path)) {
							@mkdir(DIR_IMAGE . $path, 0777);
						}
					}

					if (strtolower($extension) == 'jpg' || strtolower($extension) == 'jpeg') {
						$image_original = imagecreatefromjpeg(DIR_IMAGE . $image_new);
					} elseif (strtolower($extension) == 'png') {
						$image_original = imagecreatefrompng(DIR_IMAGE . $image_new);
					}

					if (isset($image_original)) {
						imagewebp($image_original, DIR_IMAGE . $oct_webp_image, 85);
						imagedestroy($image_original);

						if (filesize(DIR_IMAGE . $oct_webp_image) % 2 == 1) {
							file_put_contents(DIR_IMAGE . $oct_webp_image, "\0", FILE_APPEND);
						}
					} else {
						$oct_webp_image = false;
					}
				}
			}
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[. $image_new;]]></search>
			<add position="replace"><![CDATA[. ((isset($oct_webp_image) && $oct_webp_image) ? $oct_webp_image : $image_new);]]></add>
    	</operation>
	</file>
		<file path="catalog/controller/extension/module/{featured,bestseller,latest,special}.php|catalog/controller/product/{category,manufacturer,special,search}.php">
		<operation error="skip">
			<search><![CDATA[$data['products'][] = array(]]></search>
			<add position="before"><![CDATA[
			$result = (isset($product_info) && $product_info) ? $product_info : $result;

			if ($result['quantity'] <= 0) {
				$stock = $result['stock_status'];
			} else {
				$stock = false;
			}

			$can_buy = true;

			if ($result['quantity'] <= 0 && !$this->config->get('config_stock_checkout')) {
				$can_buy = false;
			} elseif ($result['quantity'] <= 0 && $this->config->get('config_stock_checkout')) {
				$can_buy = true;
			}

			$oct_grayscale = ($this->config->get('theme_oct_deals_no_quantity_grayscale') && !$can_buy) ? true : false;
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA['special'     => $special,]]></search>
			<add position="after"><![CDATA[
			'stock'     => $stock,
			'can_buy'   => $can_buy,
			'oct_grayscale'  => $oct_grayscale,
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/product.php">
		<operation error="skip">
			<search><![CDATA[$discounts = $this->model_catalog_product->getProductDiscounts($this->request->get['product_id']);]]></search>
			<add position="before"><![CDATA[
			if ($product_info['quantity'] <= 0) {
				$data['is_stock'] = $product_info['stock_status'];
			} else {
				$data['is_stock'] = false;
			}

			$data['can_buy'] = true;

			if ($product_info['quantity'] <= 0 && !$this->config->get('config_stock_checkout')) {
				$data['can_buy'] = false;
			} elseif ($product_info['quantity'] <= 0 && $this->config->get('config_stock_checkout')) {
				$data['can_buy'] = true;
			}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$data['products'][] = array(]]></search>
			<add position="before"><![CDATA[
			if ($result['quantity'] <= 0) {
				$stock = $result['stock_status'];
			} else {
				$stock = false;
			}

			$can_buy = true;

			if ($result['quantity'] <= 0 && !$this->config->get('config_stock_checkout')) {
				$can_buy = false;
			} elseif ($result['quantity'] <= 0 && $this->config->get('config_stock_checkout')) {
				$can_buy = true;
			}

			$oct_grayscale = ($this->config->get('theme_oct_deals_no_quantity_grayscale') && !$can_buy) ? true : false;
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA['special'     => $special,]]></search>
			<add position="after"><![CDATA[
			'stock'     => $stock,
			'can_buy'   => $can_buy,
			'oct_grayscale'  => $oct_grayscale,
			]]></add>
		</operation>
	</file>
		<file path="catalog/controller/mail/order.php">
		<operation error="skip">
			<search><![CDATA[$data['products'] = array();]]></search>
			<add position="after"><![CDATA[
			$this->load->model('tool/image');
			$this->load->model('catalog/product');

			$data['oct_deals_data'] = $oct_deals_data = $this->config->get('theme_oct_deals_data');

			$oct_deals_contact_address = $oct_deals_data['contact_address'];

			$results = $this->model_localisation_language->getLanguages();

			if(isset($results[$this->session->data['language']])) {
				$lang_id = $results[$this->session->data['language']]['language_id'];
			}

			$data['oct_deals_contact_address'] = (isset($oct_deals_contact_address[$lang_id]) && !empty($oct_deals_contact_address[$lang_id])) ? html_entity_decode($oct_deals_contact_address[$lang_id], ENT_QUOTES, 'UTF-8') : false;

			$data['oct_deals_contact_telephone'] = (isset($oct_deals_data['contact_telephone']) && !empty($oct_deals_data['contact_telephone'])) ? array_values(array_filter(explode(PHP_EOL, $oct_deals_data['contact_telephone']))) : false;

			$data['oct_deals_contact_open'] = (isset($oct_deals_data['contact_open'][$lang_id]) && !empty($oct_deals_data['contact_open'][$lang_id])) ? array_values(array_filter(explode(PHP_EOL, $oct_deals_data['contact_open'][$lang_id]))) : false;

			$data['oct_deals_socials'] = (isset($oct_deals_data['socials']) && !empty($oct_deals_data['socials'])) ? $oct_deals_data['socials'] : false;
			]]></add>
		</operation>
 		<operation error="skip">
			<search><![CDATA[$data['products'][] = array(]]></search>
			<add position="before"><![CDATA[
			$product_info = $this->model_catalog_product->getProduct($order_product['product_id']);
			]]></add>
		</operation>
 		<operation error="skip">
			<search><![CDATA[$data['products'][] = array(]]></search>
			<add position="after"><![CDATA[
			'image' => ($product_info['image']) ? $this->model_tool_image->resize($product_info['image'], 100, 100) : '',
			'href'  => $this->url->link('product/product', 'product_id=' . $order_product['product_id']),
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$this->load->language('mail/order_alert');]]></search>
			<add position="after"><![CDATA[
			$download_status = false;

			$order_products = $this->model_checkout_order->getOrderProducts($order_info['order_id']);

			foreach ($order_products as $order_product) {
				$product_download_query = $this->db->query("SELECT COUNT(*) AS total FROM `" . DB_PREFIX . "product_to_download` WHERE product_id = '" . (int)$order_product['product_id'] . "'");

				if ($product_download_query->row['total']) {
					$download_status = true;
				}
			}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$order_status_query = $this->db->query("SELECT * FROM " . DB_PREFIX . "order_status WHERE order_status_id = '" . (int)$order_status_id . "' AND language_id = '" . (int)$this->config->get('config_language_id') . "'");]]></search>
			<add position="before"><![CDATA[
			$this->load->language('mail/order_add');
			// HTML Mail
			$data['title'] = sprintf($this->language->get('text_subject'), $order_info['store_name'], $order_info['order_id']);

			$data['text_greeting'] = sprintf($this->language->get('text_greeting'), $order_info['store_name']);

			$data['logo'] = $order_info['store_url'] . 'image/' . $this->config->get('config_logo');
			$data['store_name'] = $order_info['store_name'];
			$data['store_url'] = $order_info['store_url'];
			$data['customer_id'] = $order_info['customer_id'];
			$data['link'] = $order_info['store_url'] . 'index.php?route=account/order/info&order_id=' . $order_info['order_id'];

			if ($download_status) {
				$data['download'] = $order_info['store_url'] . 'index.php?route=account/download';
			} else {
				$data['download'] = '';
			}

			$data['order_id'] = $order_info['order_id'];
			$data['date_added'] = date($this->language->get('date_format_short'), strtotime($order_info['date_added']));
			$data['payment_method'] = $order_info['payment_method'];
			$data['shipping_method'] = $order_info['shipping_method'];
			$data['email'] = $order_info['email'];
			$data['telephone'] = $order_info['telephone'];
			$data['ip'] = $order_info['ip'];

			if (file_exists(DIR_APPLICATION."model/tool/simplecustom.php")) {
                $this->load->model('tool/simplecustom');
                $customInfo = $this->model_tool_simplecustom->getCustomFields('order', $order_info['order_id'], $order_info['language_code']);
			}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$order_status_query = $this->db->query("SELECT * FROM " . DB_PREFIX . "order_status WHERE order_status_id = '" . (int)$order_status_id . "' AND language_id = '" . (int)$this->config->get('config_language_id') . "'");]]></search>
			<add position="after"><![CDATA[
			if ($comment && $notify) {
				$data['comment'] = nl2br($comment);
			} else {
				$data['comment'] = '';
			}

			if ($order_info['payment_address_format']) {
				$format = $order_info['payment_address_format'];
			} else {
				$format = '{firstname} {lastname}' . "\n" . '{company}' . "\n" . '{address_1}' . "\n" . '{address_2}' . "\n" . '{city} {postcode}' . "\n" . '{zone}' . "\n" . '{country}';
			}

			$find = array(
				'{firstname}',
				'{lastname}',
				'{company}',
				'{address_1}',
				'{address_2}',
				'{city}',
				'{postcode}',
				'{zone}',
				'{zone_code}',
				'{country}'
			);

			$replace = array(
				'firstname' => $order_info['payment_firstname'],
				'lastname'  => $order_info['payment_lastname'],
				'company'   => $order_info['payment_company'],
				'address_1' => $order_info['payment_address_1'],
				'address_2' => $order_info['payment_address_2'],
				'city'      => $order_info['payment_city'],
				'postcode'  => $order_info['payment_postcode'],
				'zone'      => $order_info['payment_zone'],
				'zone_code' => $order_info['payment_zone_code'],
				'country'   => $order_info['payment_country']
			);

			$data['payment_address'] = str_replace(array("\r\n", "\r", "\n"), '<br />', preg_replace(array("/\s\s+/", "/\r\r+/", "/\n\n+/"), '<br />', trim(str_replace($find, $replace, $format))));

			if ($order_info['shipping_address_format']) {
				$format = $order_info['shipping_address_format'];
			} else {
				$format = '{firstname} {lastname}' . "\n" . '{company}' . "\n" . '{address_1}' . "\n" . '{address_2}' . "\n" . '{city} {postcode}' . "\n" . '{zone}' . "\n" . '{country}';
			}

			$find = array(
				'{firstname}',
				'{lastname}',
				'{company}',
				'{address_1}',
				'{address_2}',
				'{city}',
				'{postcode}',
				'{zone}',
				'{zone_code}',
				'{country}'
			);

			$replace = array(
				'firstname' => $order_info['shipping_firstname'],
				'lastname'  => $order_info['shipping_lastname'],
				'company'   => $order_info['shipping_company'],
				'address_1' => $order_info['shipping_address_1'],
				'address_2' => $order_info['shipping_address_2'],
				'city'      => $order_info['shipping_city'],
				'postcode'  => $order_info['shipping_postcode'],
				'zone'      => $order_info['shipping_zone'],
				'zone_code' => $order_info['shipping_zone_code'],
				'country'   => $order_info['shipping_country']
			);

			$data['shipping_address'] = str_replace(array("\r\n", "\r", "\n"), '<br />', preg_replace(array("/\s\s+/", "/\r\r+/", "/\n\n+/"), '<br />', trim(str_replace($find, $replace, $format))));
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA['total'    => html_entity_decode($this->currency->format($order_product['total'] + ($this->config->get('config_tax') ? ($order_product['tax'] * $order_product['quantity']) : 0), $order_info['currency_code'], $order_info['currency_value']), ENT_NOQUOTES, 'UTF-8')]]></search>
			<add position="before"><![CDATA[
			'price'    => html_entity_decode($this->currency->format($order_product['price'] + ($this->config->get('config_tax') ? $order_product['tax'] : 0), $order_info['currency_code'], $order_info['currency_value'])),
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$mail->setText($this->load->view('mail/order_alert', $data));]]></search>
			<add position="replace"><![CDATA[
			$mail->setHtml($this->load->view('mail/order_alert', $data));
			]]></add>
		</operation>
	</file>
</modification>